{% extends 'bembechat/base_page.html' %}
{% block title %}Rooms | {% endblock %}

{% block content %}

<!DOCTYPE html>
{% comment %} Add "load static so the stylesheet can be used" {% endcomment %}
{% load static %}

      <html>
      <head>
            <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
            rel="stylesheet">
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
            <link rel="stylesheet" href="{% static 'css/rooms_page.css' %}"/>

             {% comment %} <script src="https://cdn.tailwindcss.com"></script> {% endcomment %}
      </head>
      <body>
            <div class="form-container">
                  <h3>What Room are you Joining?</h3>
                        <div class="form-and-logo">
                              <div class="form">
                                    <div>
                                          <label for="">Enter room name</label><br>
                                          <input type="text" id="room-name-input" placeholder="Enter room name" name="roomName" required=True>
                                    </div>

                                    <div>
                                          <label class="label">Enter Password</label><br>
                                          <input type="password" id="password" placeholder="Password" name="password" required>
                                    </div>

                              <button class="btn btn-primary sign-up-form-button" onclick={myFunc()}>Submit</button>
                                    <span class="material-icons eye" onclick={showPassword()}>visibility</span>
                              </div>

                              <div  class = "logo-container">
                                    <img id="app-logo" src="https://i.imgur.com/bLsbDoC.png" alt="app-logo">
                              </div>
                        </div>

                  </div>
            </div>

                   <div class="rooms-container">
                        {% for room in rooms %}
                              <div class="single-room">
                                    <div class="h2">
                                          <h2 class="room-name">{{ room.name }}</h2>
                                    </div>
                                    <div id="join">
                                          <a class="join" href="{% url 'room' room.slug %}">Join</a>

                                    </div>
                                    <p class="join-text">CLICK ON JOIN TO JOIN THE ROOM</p>
                              </div>
                        {% endfor %}
                  </div>
      </body>

      <script>

            // Declare a function that will return the room to the user so they can click on "Join" and access the room.
            function myFunc() {
            let userRoomName = document.querySelector('#room-name-input').value;
            let userRoomPassword = document.querySelector('#password').value;

            let roomsUsernameArray = document.getElementsByClassName('h2');
            let roomsPasswordsArray = document.getElementsByClassName('join');

            // console.log(roomsPasswordsArray[0].attributes[1].value.substring(0, roomsPasswordsArray[0].length - 1));

            // console.log(roomsPasswordsArray[0].href.substring(28, roomsPasswordsArray[0].href.length-1));

                        for (i = 0; i < roomsUsernameArray.length; i++) {

                              //.firstElementChild.childNodes[0].data
                              let roomFromDatabase = roomsUsernameArray[i].firstElementChild.childNodes[0].data;
                              let passwordFromDatabase = roomsPasswordsArray[i].href.substring(28, roomsPasswordsArray[i].href.length-1);
                              console.log(roomFromDatabase, passwordFromDatabase)
                               console.log(userRoomName, userRoomPassword);

                              if((roomFromDatabase === userRoomName) && (passwordFromDatabase === userRoomPassword)) {
                                    // console.log(userRoomName);
                                    // console.log(userRoomPassword);
                                    roomsUsernameArray[i].parentElement.style.display = 'block';
                              }

                              else{
                                    console.log('Value(s) not correct')
                                    //console.log(d[i].firstElementChild.childNodes[0].data);
                              }
                        }
                        userRoomName = document.querySelector('#room-name-input').value = '';
                        userRoomPassword = document.querySelector('#password').value = '';
                  }



            {% comment %} Grab the password field {% endcomment %}
            const eye = document.getElementById("password");

            {% comment %} eclare a function that shows the password by changing the type from password to text {% endcomment %}
            function showPassword(){
                if (eye.type === 'password'){
                    eye.type = 'text';
                } else{
                     eye.type = "password";
                }

            }

        </script>

      </html>

{% endblock %}
